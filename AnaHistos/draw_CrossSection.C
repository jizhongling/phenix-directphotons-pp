void GenerateGraph(TFile *f, Int_t part, Int_t ispion, Int_t gn, Double_t **gx, Double_t **gy, Double_t **egy)
{
  const Double_t PI = 3.1415927;
  const Double_t BBCCount = 4.193255 * pow(10,12);  // 4193255288313
  const Double_t BBCRatio = 0.67;
  const Double_t eBBCRatio = 0.16;
  const Double_t BBCCross = 32.5 * pow(10,9);
  const Double_t eBBCCross = 3.25 * pow(10,9);
  const Double_t BR[30] = {0.0444823,0.155126,0.189877,0.209775,0.227416,0.235346,0.242619,0.258304,0.254693,0.219828,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313,0.243313};
  const Double_t eBR[30] = {1.60171e-05,0.00010065,0.000293243,0.000651539,0.00129034,0.00232753,0.00398618,0.00663705,0.0101993,0.0144502,0.0228892,0.0291354,0.0348798,0.0512812,0.0699279,0.078914,0.111523,0.142477,0.247947,0.213559,0.156142,0.154185,0.30816,0.8415,0.8415};

  if(ispion == 0)
  {
    if(part == 0)
    {
      const Int_t sector_low = 1;
      const Int_t sector_high = 4;
      const Double_t MissR[30] = {30.2289,11.8119,5.22569,3.45314,2.71855,2.4104,1.91798,1.49926,1.50953,1.60804,1.27478,1.20157,1.16927,1.20316,0.949105,1.04787,1.0537,0.989739,1.00758,0.923549,0.954894,0.915802,0.973693,0.975281,1.11823,1.35194,1.51692,1.93743,2.41726,3.13646};
      const Double_t eMissR[30] = {15.1621,0.758324,0.344121,0.230643,0.185072,0.159158,0.128833,0.105346,0.101662,0.109452,0.0886653,0.0843563,0.0816745,0.0858706,0.0687979,0.0746921,0.0767029,0.0739533,0.0742923,0.071653,0.0400532,0.0410871,0.0480776,0.0510668,0.0649702,0.0793646,0.0922339,0.130031,0.18142,0.334484};
      const Double_t Acceptance[30] = {0.0333975,0.466338,0.0969949,0.0922672,0.0881462,0.096464,0.086961,0.0851027,0.093971,0.092485,0.0872386,0.0868118,0.0926191,0.0900973,0.0847988,0.0884147,0.0863759,0.0857754,0.0840933,0.0800305,0.0789216,0.0715952,0.0633771,0.061244,0.0543467,0.0565064,0.0598015,0.0659419,0.0845253,0.132764};
      const Double_t eAcceptance[30] = {0.000280263,0.00390269,0.00093862,0.000898753,0.000848373,0.000931083,0.00083483,0.000819581,0.000905221,0.000894302,0.000842579,0.000838163,0.000904048,0.000871577,0.000828646,0.000861077,0.000845497,0.000837581,0.000820052,0.000782412,0.000408079,0.000368704,0.000329955,0.00032333,0.000292438,0.000316279,0.000359636,0.000450471,0.000729418,0.00196937};
      const Double_t Smear[30] = {0.917729,1.00633,1.14825,1.12254,1.16406,1.15534,1.14387,1.08724,1.04397,1.19259,1.11401,1.08243,1.09937,1.08396,1.05962,1.1155,1.01567,1.11697,1.05258,1.03892,1.08092,1.05828,1.06569,1.06397,1.06614,1.0498,1.05094,1.0626,1.09115,1.48079};
      const Double_t eSmear[30] = {0.0353803,0.037015,0.0498044,0.0507489,0.0532061,0.0507488,0.0510535,0.0479079,0.0473473,0.0523246,0.0511518,0.0486528,0.0497655,0.0488145,0.0474966,0.0501719,0.0456049,0.050353,0.0470434,0.0472703,0.0255918,0.0251296,0.0259282,0.0259721,0.0269765,0.0271598,0.0293824,0.0334561,0.0431621,0.0952064};
      const Double_t TrigE[30] = {0.00036385,0.000716881,0.00289457,0.00755369,0.0161236,0.0306438,0.0645085,0.16237,0.350848,0.578751,0.766233,0.876308,0.93351,0.957188,0.96763,0.969398,0.972127,0.973223,0.978086,0.970194,0.975194,0.972113,0.971689,0.980462,0.980456,0.98995,0.95614,0.949367,0.952381,0.981132};
      const Double_t eTrigE[30] = {1.23873e-05,3.91823e-06,1.87906e-05,5.60167e-05,0.000130018,0.000257689,0.000495258,0.00095457,0.00153861,0.00197518,0.0020809,0.00198639,0.00184785,0.00183335,0.0018901,0.00220256,0.00246629,0.00285019,0.0029572,0.00397123,0.00230294,0.00387911,0.00595177,0.00774164,0.0114976,0.0131089,0.0285974,0.0382474,0.0441827,0.0420744};
      //const Double_t TrigE[30] = {0.00164522,0.00311543,0.0177058,0.0903341,0.300682,0.601194,0.825077,0.926874,0.960061,0.973145,0.976158,0.977453,0.97683,0.976518,0.977739,0.974832,0.977281,0.97863,0.979375,0.97149,0.975565,0.972113,0.971689,0.980462,0.980456,0.98995,0.95614,0.949367,0.952381,0.981132};
      //const Double_t eTrigE[30] = {2.5872e-05,8.13535e-06,4.59498e-05,0.000184478,0.00047033,0.000727355,0.000763407,0.000676101,0.000638502,0.000659215,0.000766917,0.000916591,0.00113789,0.00139175,0.00159378,0.00201701,0.00225214,0.00258267,0.00288121,0.00389679,0.00228759,0.00387911,0.00595177,0.00774164,0.0114976,0.0131089,0.0285974,0.0382474,0.0441827,0.0420744};
    }
    else if(part == 1)
    {
      const Int_t sector_low = 5;
      const Int_t sector_high = 6;
      const Double_t MissR[30] = {17.9348,12.3729,5.15907,3.2763,1.9015,1.99257,1.92512,1.40214,1.43725,1.00234,1.0441,0.921528,0.857008,1.02203,1.01143,0.702378,0.672869,0.731387,0.794395,0.686583,0.573489,0.577754,0.554708,0.638644,0.597333,0.903517,1.0415,1.5871,2.0419,3.13813};
      const Double_t eMissR[30] = {10.3753,1.19084,0.455178,0.277606,0.165308,0.184666,0.168852,0.133386,0.133757,0.0981887,0.10174,0.0915687,0.0846673,0.0999636,0.101668,0.0748862,0.0765972,0.0795308,0.0854709,0.0757425,0.0358931,0.0397247,0.0394515,0.0483185,0.0515779,0.0806279,0.0919435,0.146037,0.210989,0.445654};
      const Double_t Acceptance[30] = {0.0113787,0.256273,0.0518918,0.0565398,0.0469039,0.0466271,0.052476,0.0516823,0.0468618,0.0483947,0.0462573,0.045452,0.0506924,0.0467656,0.0480315,0.0461466,0.0448491,0.0447523,0.041482,0.0417161,0.0410685,0.0365554,0.0347334,0.0315324,0.026861,0.0256156,0.0285189,0.0328397,0.0408168,0.0773526};
      const Double_t eAcceptance[30] = {9.54873e-05,0.00214469,0.000502157,0.000550741,0.000451432,0.000450051,0.000503772,0.000497726,0.000451419,0.000467962,0.000446768,0.000438836,0.000494805,0.000452398,0.000469359,0.000449425,0.000439009,0.000436998,0.000404519,0.000407835,0.000212352,0.000188255,0.00018083,0.000166471,0.000144538,0.000143376,0.000171508,0.000224339,0.000352232,0.00114741};
      const Double_t Smear[30] = {0.953122,0.961287,1.16271,1.22744,1.18522,1.03922,1.06557,1.12872,1.12135,1.06531,1.13274,1.13029,1.08191,1.06088,1.06006,0.973574,1.08304,1.06767,0.989499,1.09119,1.08502,1.07769,1.04385,1.069,1.05547,1.03861,1.09121,1.05725,1.04311,1.5111};
      const Double_t eSmear[30] = {0.0542788,0.0523834,0.0756496,0.080098,0.0749419,0.0676348,0.0711552,0.0723044,0.0716856,0.0672427,0.0741465,0.0748741,0.0704224,0.0712935,0.0717517,0.0664484,0.0722228,0.0690087,0.0654933,0.0732659,0.0379495,0.0374642,0.0362525,0.0381689,0.0384977,0.0393928,0.0447302,0.0488738,0.0596545,0.142828};
      const Double_t TrigE[30] = {0.000269729,0.000554855,0.00236118,0.00657727,0.0151164,0.0325484,0.070641,0.160133,0.304121,0.489264,0.652533,0.793123,0.870267,0.910218,0.926269,0.939159,0.951165,0.956281,0.945406,0.949167,0.947981,0.9375,0.961864,0.958647,0.923077,0.971429,0.938776,1,1,0.941176};
      const Double_t eTrigE[30] = {1.44465e-05,4.66004e-06,2.25488e-05,7.07994e-05,0.000176681,0.000381818,0.00074537,0.00136677,0.00213866,0.00284809,0.00333493,0.00345842,0.00347648,0.0035459,0.00390082,0.00424238,0.00450894,0.00508226,0.006515,0.0071651,0.00459131,0.00810229,0.0110001,0.0161302,0.0292263,0.0364645,0.0560174,0.0738787,0.108745,0.122644};
      //const Double_t TrigE[30] = {0.00135703,0.0025061,0.0145995,0.0726695,0.251644,0.524813,0.750927,0.86165,0.908702,0.924075,0.933276,0.938768,0.940514,0.940573,0.943594,0.948838,0.942286,0.943719,0.942077,0.941667,0.944707,0.95625,0.927966,0.958647,0.93007,0.928571,0.938776,0.958333,1,1};
      //const Double_t eTrigE[30] = {3.14961e-05,9.8506e-06,5.54099e-05,0.000225664,0.000622711,0.00106453,0.00125129,0.00128775,0.00134918,0.00153028,0.00177652,0.00208064,0.00248129,0.00296011,0.00346993,0.00393437,0.0048449,0.00565658,0.00667748,0.00758112,0.00471354,0.00700526,0.0139623,0.0161302,0.0283592,0.0454578,0.0560174,0.0894327,0.108745,0.102689};
    }
    else if(part == 2)
    {
      const Int_t sector_low = 7;
      const Int_t sector_high = 8;
      const Double_t MissR[30] = {44.8056,12.9782,5.11743,3.08484,2.30382,1.86485,1.70953,1.42307,1.12242,1.28712,1.21878,0.960307,0.878825,0.772734,0.619535,0.768462,0.760666,0.793876,0.710651,0.651542,0.583946,0.495129,0.506443,0.524992,0.493668,0.43272,0.442327,0.48731,0.496306,0.510509};
      const Double_t eMissR[30] = {27.4776,1.08155,0.414745,0.254924,0.195492,0.162153,0.147458,0.13439,0.105885,0.114233,0.118884,0.0964517,0.0856813,0.0790311,0.0638918,0.0755499,0.07875,0.0804221,0.0800447,0.0696723,0.033626,0.0286794,0.031614,0.0351141,0.0339287,0.0354308,0.0358912,0.044814,0.0476615,0.065303};
      const Double_t Acceptance[30] = {0.0141177,0.266558,0.0566042,0.0571151,0.0557601,0.0611945,0.0582462,0.0584406,0.0552585,0.0625495,0.0602437,0.0507833,0.0584742,0.0579077,0.0553255,0.0605693,0.0556036,0.0616205,0.0548318,0.0567923,0.0578021,0.0543528,0.0545246,0.0522501,0.0531501,0.0483452,0.0465811,0.0491233,0.0555147,0.0874928};
      const Double_t eAcceptance[30] = {0.000118472,0.00223077,0.000547759,0.000556345,0.000536669,0.000590657,0.000559167,0.000562812,0.000532304,0.000604834,0.000581853,0.000490309,0.000570763,0.000560183,0.000540636,0.000589889,0.00054428,0.000601713,0.000534703,0.000555225,0.000298876,0.000279908,0.000283867,0.000275848,0.000285999,0.000270599,0.00028013,0.000335577,0.000479069,0.00129783};
      const Double_t Smear[30] = {1.00682,0.93535,1.12194,1.19194,1.13168,1.13583,1.24479,1.12686,1.13593,1.20425,1.15742,1.20454,1.22982,1.12088,1.20276,1.30014,1.28389,1.20988,1.16998,1.22525,1.26973,1.29905,1.28267,1.32714,1.32478,1.35913,1.42392,1.45609,1.84625,3.00666};
      const Double_t eSmear[30] = {0.0535118,0.0465713,0.0677599,0.0743985,0.0689997,0.0709085,0.0744999,0.0684519,0.068995,0.0726542,0.0717698,0.0753872,0.0765055,0.0686541,0.0737477,0.0801868,0.0802004,0.0746237,0.0710075,0.0762464,0.0413532,0.0426517,0.0423268,0.044556,0.0449116,0.0483652,0.0532628,0.0610961,0.092239,0.224152};
      const Double_t TrigE[30] = {0.000294266,0.000564111,0.00219625,0.00545686,0.0119678,0.0241106,0.0536843,0.11403,0.219922,0.345882,0.472043,0.589561,0.668584,0.725446,0.776511,0.801399,0.831891,0.838522,0.854925,0.85997,0.864641,0.860922,0.87033,0.862305,0.850794,0.863636,0.870536,0.78626,0.87234,0.810345};
      const Double_t eTrigE[30] = {1.45093e-05,4.43517e-06,2.13784e-05,5.90693e-05,0.000133753,0.00026027,0.000510963,0.000904507,0.00144343,0.00199885,0.00249607,0.00291234,0.00327906,0.00359619,0.00394092,0.00433136,0.00457565,0.00520078,0.00556448,0.00632279,0.00391181,0.00595482,0.00836447,0.0116314,0.0155803,0.0208249,0.0264722,0.0419418,0.0442089,0.0658858};
      //const Double_t TrigE[30] = {0.000380202,0.000801653,0.00359095,0.011629,0.0380037,0.105464,0.231032,0.368785,0.476612,0.553128,0.603489,0.629949,0.645152,0.658893,0.673057,0.672309,0.679387,0.677607,0.680649,0.66484,0.675435,0.665939,0.682967,0.675781,0.650794,0.633523,0.674107,0.671756,0.648936,0.62069};
      //const Double_t eTrigE[30] = {1.64e-05,5.2799e-06,2.72599e-05,8.56723e-05,0.000234032,0.000518159,0.00095045,0.00136729,0.00173553,0.00208698,0.00244799,0.00286027,0.00333136,0.00381301,0.00442011,0.00506502,0.00565878,0.00653198,0.00725974,0.00844345,0.00529005,0.00797528,0.0112893,0.0152957,0.0200328,0.0274804,0.0343263,0.0461244,0.0560222,0.0740304};
    }
    else
    {
      cerr << "Wrong part " << part << endl;
      exit(1);
    }
  }
  else if(ispion == 1)
  {
    if(part == 0)
    {
      const Int_t sector_low = 1;
      const Int_t sector_high = 4;
      const Double_t MissR[30] = {0,11.7802,3.07179,1.72708,1.62595,1.23993,1.20061,1.08821,1.02846,1.00488,0.907233,0.848244,0.846378,0.815206,0.758507,0.742466,0.726814,0.707152,0.697826,0.689368,0.638957,0.627563,0.608864,0.686524,0.845587,1.006,1.55807,1.92662,2.95198,3.81868};
      const Double_t eMissR[30] = {0,1.22536,0.180236,0.0828741,0.0749084,0.0530313,0.0494889,0.0438912,0.0410025,0.039191,0.0354346,0.0324785,0.0323087,0.0310294,0.028808,0.0283372,0.0276609,0.0266715,0.0263539,0.0260299,0.0127855,0.0128936,0.0135227,0.0168952,0.0231754,0.0299141,0.0531829,0.06929,0.119505,0.162047};
      const Double_t Acceptance[30] = {0,0,0.0503333,0.0610073,0.0663017,0.071695,0.0729861,0.074143,0.0739462,0.077014,0.0774791,0.0821969,0.0784768,0.0818335,0.0775537,0.0802211,0.0804874,0.0793412,0.0810137,0.0789342,0.0789544,0.0718711,0.0609769,0.0474466,0.0378485,0.0323227,0.0242847,0.0229878,0.0204733,0.0197755};
      const Double_t eAcceptance[30] = {0,0,0.000441664,0.000512659,0.000547581,0.000582367,0.000582922,0.000588024,0.00058478,0.000611075,0.000611315,0.000643084,0.000613593,0.00064448,0.00060397,0.000624721,0.000632349,0.000614827,0.000634821,0.00061486,0.000322004,0.000289643,0.00024365,0.000188365,0.000149734,0.000127908,9.5391e-05,9.01882e-05,8.03171e-05,7.70568e-05};
      const Double_t Smear[30] = {0,0,0.88385,1.04499,1.0231,1.13176,1.07586,1.04761,1.087,1.05929,1.08917,1.11467,1.00637,1.1191,0.994612,1.09007,1.08234,1.00524,1.08042,1.05133,1.04236,1.0592,1.07974,1.04979,1.05967,1.0518,1.02682,1.0698,1.03018,0.91226};
      const Double_t eSmear[30] = {0,0,0.056554,0.06223,0.0546813,0.0574719,0.0527679,0.0512593,0.0508041,0.0495695,0.051302,0.0517243,0.0467729,0.0503892,0.0442187,0.0483369,0.0471697,0.0429209,0.046725,0.0451935,0.0230536,0.0225947,0.0227181,0.0215629,0.0214289,0.0212466,0.0202437,0.0212453,0.0199182,0.0188465};
      const Double_t TrigE[30] = {0,0.00245558,0.00313025,0.00648996,0.0117721,0.019222,0.0269097,0.0391966,0.0675806,0.131207,0.233035,0.356675,0.503742,0.642568,0.777764,0.864382,0.91893,0.952318,0.970608,0.974947,0.977843,0.981401,0.975359,0.984211,1,0.984615,1,1,1,1};
      const Double_t eTrigE[30] = {0,0.000750903,6.05212e-05,9.88187e-05,0.000179838,0.000307017,0.000473223,0.000716733,0.0011341,0.00182118,0.00267414,0.0035307,0.00428026,0.00471634,0.00468575,0.00446373,0.00414247,0.00373946,0.00346727,0.00365343,0.00217736,0.00325664,0.00603529,0.00931713,0.0122049,0.0345063,0.0769639,0.11556,0.369032,0.458818};
      //const Double_t TrigE[30] = {0,0.00794453,0.0113007,0.0253374,0.0625652,0.158359,0.330616,0.537172,0.712516,0.838904,0.913115,0.953653,0.974597,0.97898,0.982708,0.984223,0.981195,0.981353,0.985646,0.984289,0.981505,0.981401,0.976386,0.984211,1,0.984615,1,1,1,1};
      //const Double_t eTrigE[30] = {0,0.00121732,0.000113497,0.000191958,0.000400319,0.000807713,0.00135778,0.00181596,0.00202547,0.00197991,0.00179753,0.00158584,0.00140696,0.00148788,0.00156233,0.00173603,0.00217667,0.00248066,0.00255395,0.00300417,0.00200984,0.00325664,0.00593587,0.00931713,0.0122049,0.0345063,0.0769639,0.11556,0.369032,0.458818};
    }
    else if(part == 1)
    {
      const Int_t sector_low = 5;
      const Int_t sector_high = 6;
      const Double_t MissR[30] = {0,13.7512,3.23104,1.85759,1.28414,1.17153,0.930381,0.779495,0.739219,0.640742,0.639841,0.623385,0.584066,0.535084,0.565444,0.477119,0.538733,0.456101,0.440535,0.458134,0.389708,0.349245,0.344955,0.379282,0.445031,0.636044,0.857116,1.44847,2.2226,3.44172};
      const Double_t eMissR[30] = {0,2.03261,0.267037,0.11964,0.0760228,0.0665644,0.0509618,0.0410007,0.0391931,0.0326059,0.0335095,0.0321812,0.0302507,0.0279764,0.0295531,0.0246424,0.0278606,0.0236091,0.0232645,0.0242084,0.0108199,0.0103618,0.0109057,0.0134854,0.0173379,0.0270614,0.0400538,0.0745087,0.123199,0.213347};
      const Double_t Acceptance[30] = {0,0,0.0264836,0.0333306,0.0360523,0.0367723,0.038468,0.0397522,0.0393312,0.0440183,0.0399423,0.0387316,0.0395565,0.0430497,0.0397998,0.0427999,0.0421283,0.0444761,0.0413411,0.0405012,0.0423571,0.0387468,0.0327851,0.024941,0.0191125,0.0141086,0.0105787,0.00831886,0.00762099,0.00667157};
      const Double_t eAcceptance[30] = {0,0,0.000232388,0.000280085,0.000297753,0.000298695,0.000307234,0.000315273,0.000311038,0.000349268,0.000315148,0.000303024,0.000309283,0.000339038,0.000309952,0.000333304,0.000330981,0.000344652,0.000323947,0.000315485,0.000172747,0.000156151,0.000131002,9.90172e-05,7.56118e-05,5.58308e-05,4.15536e-05,3.26375e-05,2.98972e-05,2.59963e-05};
      const Double_t Smear[30] = {0,0,0.855307,0.993325,0.909117,1.07722,1.0727,1.09681,0.959494,1.23678,1.0138,1.00096,1.09915,1.04102,1.05418,1.08455,1.04873,1.08632,1.04557,1.06438,1.05826,1.06538,1.0469,1.07063,1.05238,1.07157,1.04929,1.07831,1.02589,0.888965};
      const Double_t eSmear[30] = {0,0,0.0892606,0.0883507,0.0723156,0.0836635,0.0851724,0.0802716,0.0700661,0.0878699,0.0671981,0.0664275,0.0722757,0.0675377,0.0673299,0.0685775,0.0668313,0.0700965,0.0662028,0.0660608,0.0338414,0.0326503,0.0320392,0.0319711,0.0305577,0.0311139,0.030268,0.0307963,0.0290396,0.0262014};
      const Double_t TrigE[30] = {0,0.00168067,0.0021357,0.00463002,0.00856267,0.0147278,0.0219931,0.0373602,0.0679514,0.118846,0.20182,0.305839,0.41237,0.550603,0.672654,0.777747,0.858265,0.895571,0.939236,0.933386,0.943523,0.937451,0.943609,0.963158,0.911765,0.933333,1,1,1,1};
      const Double_t eTrigE[30] = {0,0.000828259,6.51155e-05,0.000107593,0.000197897,0.00035182,0.00056982,0.000936642,0.00154078,0.00235319,0.00345736,0.00456581,0.00566092,0.00653498,0.00696789,0.0071283,0.00690389,0.00703152,0.00630904,0.00773818,0.00443367,0.00753092,0.011871,0.0192918,0.0490115,0.0812873,0.231368,0.369032,0.8415,0.8415};
      //const Double_t TrigE[30] = {0,0.00462185,0.00803697,0.0182611,0.0464252,0.12066,0.265251,0.449459,0.629043,0.756872,0.841253,0.891323,0.913463,0.934819,0.93956,0.955549,0.942878,0.947786,0.942708,0.945141,0.9515,0.953088,0.956767,0.942105,0.985294,0.9,0.857143,0.75,1,1};
      //const Double_t eTrigE[30] = {0,0.00120757,0.000124158,0.000209826,0.000446079,0.000936665,0.0016832,0.00241054,0.0029155,0.00309825,0.00315626,0.00312494,0.00330887,0.00335622,0.00366831,0.00369666,0.00473208,0.00526026,0.00615531,0.00714444,0.00415061,0.0066895,0.0107304,0.0223104,0.0330212,0.0878452,0.257243,0.368546,0.8415,0.8415};
    }
    else if(part == 2)
    {
      const Int_t sector_low = 7;
      const Int_t sector_high = 8;
      const Double_t MissR[30] = {0,14.2103,3.63417,1.55831,1.26588,1.01844,0.800693,0.808538,0.78138,0.731525,0.580918,0.584121,0.582891,0.505015,0.471054,0.541257,0.46135,0.453636,0.47243,0.420344,0.406133,0.377141,0.343608,0.319768,0.320791,0.304563,0.326091,0.394433,0.467004,0.583364};
      const Double_t eMissR[30] = {0,2.17343,0.329638,0.101108,0.077518,0.0584562,0.0452805,0.0445682,0.0429988,0.0397565,0.0308922,0.0318587,0.0318497,0.026907,0.0257126,0.0301799,0.0251141,0.0245042,0.0255051,0.0232375,0.0115624,0.0107285,0.00998744,0.00941212,0.00979852,0.00995304,0.0113517,0.0145838,0.0184172,0.0235137};
      const Double_t Acceptance[30] = {0,0,0.0285889,0.0366961,0.039054,0.0436743,0.043032,0.0441539,0.0450791,0.0453911,0.0494696,0.0457495,0.0463433,0.0496203,0.0461103,0.0437052,0.0484918,0.0475351,0.0469208,0.0460801,0.048079,0.0477228,0.0476721,0.0474173,0.0438711,0.0382068,0.0325044,0.0257576,0.0207742,0.0180414};
      const Double_t eAcceptance[30] = {0,0,0.000250862,0.000308366,0.000322544,0.000354759,0.000343686,0.000350182,0.000356494,0.00036016,0.000390318,0.00035793,0.000362349,0.000390785,0.000359096,0.000340354,0.000380976,0.000368357,0.00036767,0.000358942,0.000196083,0.000192325,0.000190487,0.000188249,0.000173561,0.000151192,0.000127678,0.000101055,8.14973e-05,7.02998e-05};
      const Double_t Smear[30] = {0,0,0.826921,0.993274,0.961897,1.01002,1.06273,0.97499,1.04529,1.11787,1.04805,1.10157,1.0097,1.21474,1.14056,0.978027,1.16989,1.17928,1.17357,1.14793,1.11843,1.19968,1.20214,1.21795,1.22465,1.27215,1.26836,1.28446,1.23853,1.27468};
      const Double_t eSmear[30] = {0,0,0.0753775,0.0791471,0.0690368,0.0726844,0.0699909,0.0615804,0.0642381,0.0683563,0.0655393,0.0671857,0.0623245,0.0713398,0.0665938,0.0579418,0.0675888,0.0672193,0.0690177,0.0652343,0.0330419,0.0348125,0.0336409,0.0341586,0.0343425,0.0346996,0.0345377,0.0349239,0.0332483,0.033976};
      const Double_t TrigE[30] = {0,0.00113276,0.00228717,0.00420946,0.00742677,0.0124314,0.0209718,0.0321965,0.0565551,0.0941686,0.154672,0.231416,0.314829,0.399217,0.478049,0.540855,0.611494,0.660811,0.714073,0.76303,0.827762,0.872964,0.878685,0.874431,0.887279,0.857143,0.831522,0.82716,0.842105,0.923077};
      const Double_t eTrigE[30] = {0,0.000766023,5.94129e-05,9.12801e-05,0.00015867,0.000265865,0.000435336,0.000655859,0.00102828,0.00151723,0.00219486,0.00290487,0.00363547,0.00438439,0.00509167,0.00564094,0.00626839,0.00682544,0.00729419,0.00763897,0.00426667,0.0054956,0.0076131,0.0108121,0.0141658,0.0209955,0.0322505,0.0525959,0.0637627,0.0692411};
      //const Double_t TrigE[30] = {0,0.00113276,0.00322143,0.00634654,0.0126124,0.0256184,0.0566567,0.112993,0.196253,0.294675,0.384962,0.462232,0.530239,0.588797,0.622358,0.646552,0.684008,0.694949,0.709118,0.712121,0.737571,0.739414,0.721121,0.738854,0.724638,0.70028,0.63587,0.666667,0.77193,0.589744};
      //const Double_t eTrigE[30] = {0,0.000766023,7.01991e-05,0.000111521,0.000205229,0.000376681,0.00069668,0.00116489,0.00175223,0.00234966,0.00293473,0.00341681,0.00389416,0.00440394,0.00495351,0.00542743,0.00599536,0.00664855,0.00732938,0.00810285,0.00494341,0.00713843,0.0102144,0.0139333,0.0191066,0.0262224,0.0389,0.0604925,0.0693292,0.0929398};
    }
    else
    {
      cerr << "Wrong part " << part << endl;
      exit(1);
    }
  }
  else
  {
    cerr << "Wrong ispion " << ispion << endl;
    exit(1);
  }

  THnSparse *hn_1photon = (THnSparse*)f->Get("hn_1photon");
  hn_1photon->GetAxis(0)->SetRange(sector_low, sector_high);
  TH1 *h_1photon = hn_1photon->Projection(1);

  TH2 *h2_sig_extra = (TH2*)f->Get("h2_sig_extra");
  TH1 *h_sig_extra = h2_sig_extra->ProjectionY("h_sig_extra", sector_low, sector_high);

  TH2 *h2_bg_extra = (TH2*)f->Get("h2_bg_extra");
  TH1 *h_bg_extra = h2_bg_extra->ProjectionY("h_bg_extra", sector_low, sector_high);

  THnSparse *hn_2photon = (THnSparse*)f->Get("hn_2photon");

  TAxis *axis0 = hn_2photon->GetAxis(0);
  if(ispion == 0)
    TAxis *axis1_2 = hn_2photon->GetAxis(1);
  else if(ispion == 1)
    TAxis *axis1_2 = hn_2photon->GetAxis(2);
  TAxis *axis3 = hn_2photon->GetAxis(3);

  axis0->SetRange(sector_low, sector_high);

  Int_t bin047 = axis3->FindBin(0.047);
  Int_t bin067 = axis3->FindBin(0.067);
  Int_t bin087 = axis3->FindBin(0.087);
  Int_t bin097 = axis3->FindBin(0.097);
  Int_t bin112 = axis3->FindBin(0.112);
  Int_t bin162 = axis3->FindBin(0.162);
  Int_t bin177 = axis3->FindBin(0.177);
  Int_t bin187 = axis3->FindBin(0.187);
  Int_t bin212 = axis3->FindBin(0.212);
  Int_t bin227 = axis3->FindBin(0.227);

  const Int_t nData = 256;
  vector<Double_t> x(nData), y(nData), sigma_y(nData);

  TCanvas *c = new TCanvas("c", "Canvas", 2400, 2000);
  gStyle->SetOptStat(0);
  gStyle->SetOptFit(1111);
  c->Divide(6,5);

  Int_t ipad = 1;
  for(Int_t ipt=0; ipt<gn; ipt++)
  {
    c->cd(ipad++);

    char buf[100];
    Double_t low = axis1_2->GetBinLowEdge(ipt+1);
    Double_t high = axis1_2->GetBinLowEdge(ipt+2);
    sprintf(buf, "p_{T} %3.1f-%3.1f", low, high);

    axis1_2->SetRange(ipt+1,ipt+1);
    TH1 *h_inv_mass = hn_2photon->Projection(3);
    h_inv_mass->SetTitle(buf);

    Double_t nphoton = h_1photon->GetBinContent(ipt+1);
    Double_t nsig_extra = h_sig_extra->GetBinContent(ipt+1);
    Double_t nbg_extra = h_bg_extra->GetBinContent(ipt+1);
    Double_t nextra = nsig_extra - nbg_extra/2.;
    Double_t npair = 0.;
    Double_t nbgfit = 0.;
    Double_t nbgside = 0.;
    Double_t nbggpr = 0.;
    Double_t dnbggpr = 0.;

    x.clear();
    y.clear();
    sigma_y.clear();

    for(Int_t ib=bin067; ib<bin087; ib++)
    {
      Double_t xx = axis3->GetBinCenter(ib);
      Double_t yy = h_inv_mass->GetBinContent(ib);
      Double_t sigma_yy = h_inv_mass->GetBinError(ib);
      x.push_back(xx);
      y.push_back(yy);
      sigma_y.push_back(sigma_yy);
    }

    for(Int_t ib=bin187; ib<bin212; ib++)
    {
      Double_t xx = axis3->GetBinCenter(ib);
      Double_t yy = h_inv_mass->GetBinContent(ib);
      Double_t sigma_yy = h_inv_mass->GetBinError(ib);
      x.push_back(xx);
      y.push_back(yy);
      sigma_y.push_back(sigma_yy);
    }

    BgGPR(x, y, sigma_y, nbggpr, dnbggpr);
    nbggpr /= 0.001;
    dnbggpr /= 0.001;

    TF1 *fn1 = new TF1("fn1", "gaus", 0., 0.5);
    TF1 *fn2 = new TF1("fn2", "gaus(0)+pol2(3)", 0., 0.5);
    TF1 *fn3 = new TF1("fn3", "pol2", 0., 0.5);

    Double_t par[10];
    h_inv_mass->Fit(fn1, "Q0", "", 0.112, 0.162);
    fn2->SetParameters( fn1->GetParameters() );
    h_inv_mass->Fit(fn2, "Q", "", 0.047, 0.227);
    fn2->GetParameters(par);
    fn3->SetParameters(par[3], par[4], par[5]);
    fn3->SetLineColor(kGreen);
    fn3->Draw("SAME");

    for(Int_t ib=bin047; ib<bin097; ib++)
      nbgside += h_inv_mass->GetBinContent(ib);
    for(Int_t ib=bin177; ib<bin227; ib++)
      nbgside += h_inv_mass->GetBinContent(ib);
    nbgside /= 2.;

    for(Int_t ib=bin112; ib<bin162; ib++)
    {
      npair += h_inv_mass->GetBinContent(ib);
      Double_t bincenter = axis3->GetBinCenter(ib);
      nbgfit += fn3->Eval(bincenter);
    }

    Double_t nfit = npair - nbgfit;
    Double_t enfit = sqrt(1./npair + 1./nbgfit);
    Double_t nsub = npair - nbgside;
    Double_t ndiff = TMath::Abs(nbgfit - nbgside - nextra);
    Double_t ngpr = npair - nbggpr;
    Double_t nerror = TMath::Abs(nfit - ngpr);

    if(nfit > 0. && nfit < npair)
      Double_t npion = nfit * ( 1. + MissR[ipt] );
    else
      Double_t npion = nsub * ( 1. + MissR[ipt] );
    Double_t enpion = npion * sqrt( pow(enfit/nfit,2.) + pow(eMissR[ipt]/(1.+MissR[ipt]),2.) );
    Double_t ndecay = npion * ( 1. + BR[ipt] );
    Double_t endecay = ndecay * sqrt( pow(enpion/npion,2.) + pow(eBR[ipt]/(1.+BR[ipt]),2.) );
    Double_t ndirect = nphoton - ndecay;
    Double_t endirect = sqrt( 1./nphoton + pow(endecay/ndecay,2.) );

    if(ispion == 0)
    {
      gx[0][ipt] = (low + high) / 2.;
      gy[0][ipt] = ndirect / nphoton;
      egy[0][ipt] = gy[0][ipt] * sqrt( pow(endirect/ndirect,2.) + 1./nphoton );

      gx[1][ipt] = (low + high) / 2.;
      gy[1][ipt] = BBCCross * (ndirect/(BBCCount*BBCRatio)) / (2*PI*gx[1][ipt]) / ((high-low)*0.8) / Acceptance[ipt] / Smear[ipt] / TrigE[ipt];
      //egy[1][ipt] = gy[1][ipt] * sqrt( pow(eBBCCross/BBCCross,2.) + pow(endirect/ndirect,2.) + 1./BBCCount + pow(eBBCRatio/BBCRatio,2.)
      //    + pow(eSmear[ipt]/Smear[ipt],2.) + pow(eAcceptance[ipt]/Acceptance[ipt],2.) + pow(eTrigE[ipt]/TrigE[ipt],2.) );
      egy[1][ipt] = gy[1][ipt] * sqrt( pow(endirect/ndirect,2.)
          + pow(eSmear[ipt]/Smear[ipt],2.) + pow(eAcceptance[ipt]/Acceptance[ipt],2.) + pow(eTrigE[ipt]/TrigE[ipt],2.) );

      cout << "pT=" << low << "-" << high << "\tnphoton=" << nphoton
        << "\tnpair=" << npair << "\tnfit=" << nfit << "\tnsub=" << nsub
        << "\tndiff=" << ndiff/nfit*100. << "%\tngpr=" << ngpr
        << "\tnerror=" << nerror/nfit*100. << "%" << endl;
    }
    else if(ispion == 1)
    {
      gx[2][ipt] = (low + high) / 2.;
      gy[2][ipt] = BBCCross * (npion/2./(BBCCount*BBCRatio)) / (2*PI*gx[2][ipt]) / ((high-low)*0.8) / Acceptance[ipt] / Smear[ipt] / TrigE[ipt];
      //egy[2][ipt] = gy[2][ipt] * sqrt( pow(eBBCCross/BBCCross,2.) + pow(enpion/npion,2.) + 1./BBCCount + pow(eBBCRatio/BBCRatio,2.)
      //    + pow(eSmear[ipt]/Smear[ipt],2.) + pow(eAcceptance[ipt]/Acceptance[ipt],2.) + pow(eTrigE[ipt]/TrigE[ipt],2.) );
      egy[2][ipt] = gy[2][ipt] * sqrt( pow(enpion/npion,2.)
          + pow(eSmear[ipt]/Smear[ipt],2.) + pow(eAcceptance[ipt]/Acceptance[ipt],2.) + pow(eTrigE[ipt]/TrigE[ipt],2.) );
    }
  }


  if(ispion == 0)
  {
    if(part == 0)
    {
      c->Print("CrossSection-PbScW.pdf");
      delete c;
    }
    if(part == 1)
    {
      c->Print("CrossSection-PbScE.pdf");
      delete c;
    }
    else if(part == 2)
    {
      c->Print("CrossSection-PbGlE.pdf");
      delete c;
    }
  }
  else if(ispion == 1)
  {
    if(part == 0)
    {
      c->Print("CrossSection-PbScW-pion.pdf");
      delete c;
    }
    if(part == 1)
    {
      c->Print("CrossSection-PbScE-pion.pdf");
      delete c;
    }
    else if(part == 2)
    {
      c->Print("CrossSection-PbGlE-pion.pdf");
      delete c;
    }
  }

  return;
}

TGraphErrors **CreateGraph(TFile *f, Int_t part)
{
  const Int_t gn = 30;
  Double_t *gx[3];
  Double_t *gy[3];
  Double_t *egy[3];
  for(Int_t i=0; i<3; i++)
  {
    gx[i] = new Double_t[gn];
    gy[i] = new Double_t[gn];
    egy[i] = new Double_t[gn];
    for(Int_t j=0; j<gn; j++)
    {
      gx[i][j] = 0.;
      gy[i][j] = 0.;
      egy[i][j] = 0.;
    }
  }

  for(Int_t ispion=0; ispion<2; ispion++)
    GenerateGraph(f, part, ispion, gn, gx, gy, egy);

  TGraphErrors **graph = new TGraphErrors*[3];
  for(Int_t i=0; i<3; i++)
    graph[i] = new TGraphErrors(gn, gx[i], gy[i], 0, egy[i]);

  for(Int_t i=0; i<3; i++)
  {
    cout << "\ni = " << i << endl;
    cout << "  const Double_t gx[" << part << "][30] = {";
    for(Int_t ipt=0; ipt<gn; ipt++)
      cout << gx[i][ipt] << ",";
    cout << "};\n";
    cout << "  const Double_t gy[" << part << "][30] = {";
    for(Int_t ipt=0; ipt<gn; ipt++)
      cout << gy[i][ipt] << ",";
    cout << "};\n";
    cout << "  const Double_t egy[" << part << "][30] = {";
    for(Int_t ipt=0; ipt<gn; ipt++)
      cout << egy[i][ipt] << ",";
    cout << "};\n";
  }

  return graph;
}

void draw_CrossSection()
{
  gSystem->Load("libGausProc.so");
  gROOT->ProcessLine(".L BgGPR.C");
  gROOT->ProcessLine(".L Chi2Fit.C");

  TFile *f = new TFile("/phenix/plhf/zji/github/phenix-directphotons-pp/fun4all/offline/analysis/Run13ppDirectPhoton/PhotonNode-macros/histos-ertb-cv/total.root");

  TCanvas *c0 = new TCanvas("c0", "Canvas", 1800, 1200);
  gStyle->SetOptStat(0);
  c0->Divide(3,2);

  TGraphErrors **gr[3];
  for(Int_t part=0; part<3; part++)
  {
    cout << "part " << part << endl;
    gr[part] = CreateGraph(f, part);
    gr[part][0]->SetTitle("DirectPhoton fraction");
    gr[part][1]->SetTitle("DirectPhoton Cross Section");
    gr[part][2]->SetTitle("#pi^{0} Cross Section");
    for(Int_t i=0; i<3; i++)
    {
      c0->cd(i+1);
      if(i==0)
      {
        gr[part][i]->GetYaxis()->SetTitle("Ratio");
        gr[part][i]->GetYaxis()->SetRangeUser(0., 1.2);
      }
      else
      {
        gPad->SetLogy();
        gr[part][i]->GetYaxis()->SetTitle("Ed^{3}#sigma/dp^{3} [pb*GeV^{-2}*c^{-3}]");
        gr[part][i]->GetYaxis()->SetRangeUser(0.5, 1e5);
      }
      gr[part][i]->GetXaxis()->SetTitle("p_{T} [GeV]");
      gr[part][i]->GetYaxis()->SetTitleOffset(1.2);
      gr[part][i]->GetXaxis()->SetRangeUser(0., 30.);
      gr[part][i]->SetMarkerColor(part+1);
      gr[part][i]->SetMarkerStyle(part+20);
      gr[part][i]->SetMarkerSize(1.);
      if(part == 0)
      {
        gr[part][i]->Draw("AP");
      }
      else
      {
        gr[part][i]->Draw("P");
      }
    }
  }

  for(Int_t i=0; i<3; i++)
  {
    c0->cd(i+1);
    TLegend *leg = new TLegend(0.4, 0.7, 0.7, 0.9);
    leg->AddEntry(gr[0][i], "PbScW", "P");
    leg->AddEntry(gr[1][i], "PbScE", "P");
    leg->AddEntry(gr[2][i], "PbGlE", "P");
    leg->Draw();
  }

  const Int_t gn = 30;
  Double_t *gx[3];
  Double_t *gy[3];
  Double_t *egy[3];
  for(Int_t i=0; i<3; i++)
  {
    gx[i] = new Double_t[gn];
    gy[i] = new Double_t[gn];
    egy[i] = new Double_t[gn];
    for(Int_t j=0; j<gn; j++)
    {
      gx[i][j] = 0.;
      gy[i][j] = 0.;
      egy[i][j] = 0.;
    }
  }

  for(Int_t i=0; i<3; i++)
  {
    Double_t xx[gn][3];
    Double_t yy[gn][3];
    Double_t eyy[gn][3];
    for(Int_t ipt=0; ipt<gn; ipt++)
      for(Int_t part=0; part<3; part++)
      {
        gr[part][i]->GetPoint(ipt, xx[ipt][part], yy[ipt][part]);
        eyy[ipt][part] = gr[part][i]->GetErrorY(ipt);
        gx[i][ipt] = xx[ipt][part];
      }
    for(Int_t ipt=0; ipt<gn; ipt++)
      Chi2Fit(3, (Double_t*)yy[ipt], (Double_t*)eyy[ipt], gy[i][ipt], egy[i][ipt]);
  }

  for(Int_t i=0; i<3; i++)
  {
    c0->cd(i+4);
    TGraphErrors *grt = new TGraphErrors(gn, gx[i], gy[i], 0, egy[i]);
    if(i==0)
      grt->SetTitle("DirectPhoton fraction");
    else if(i==1)
      grt->SetTitle("DirectPhoton Cross Section");
    else
      grt->SetTitle("#pi^{0} Cross Section");
    if(i==0)
    {
      grt->GetYaxis()->SetTitle("Ratio");
      grt->GetYaxis()->SetRangeUser(0., 1.2);
    }
    else
    {
      gPad->SetLogy();
      grt->GetYaxis()->SetTitle("Ed^{3}#sigma/dp^{3} [pb*GeV^{-2}*c^{-3}]");
      grt->GetYaxis()->SetRangeUser(0.1, pow(10,5));
    }
    grt->GetXaxis()->SetTitle("p_{T} [GeV]");
    grt->GetYaxis()->SetTitleOffset(1.2);
    grt->GetXaxis()->SetRangeUser(0., 30.);
    grt->SetMarkerColor(1);
    grt->SetMarkerStyle(20);
    grt->SetMarkerSize(1.);
    grt->Draw("AP");
  }

  c0->Print("CrossSection-ertb-cv.pdf");
}
